<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Processing MADC Genotype Data" />
<meta name="author" content="Alexander M. Sandercock" />
<meta property="og:locale" content="en" />
<meta name="description" content="Processing MADC data to filter low quality microhaplotypes and convert to a VCF format with biallelic SNPs" />
<meta property="og:description" content="Processing MADC data to filter low quality microhaplotypes and convert to a VCF format with biallelic SNPs" />
<link rel="canonical" href="http://localhost:4000/BIGr_documentation/posts/madc-data-processing/" />
<meta property="og:url" content="http://localhost:4000/BIGr_documentation/posts/madc-data-processing/" />
<meta property="og:site_name" content="BIGr" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-06-18T03:13:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Processing MADC Genotype Data" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Alexander M. Sandercock","url":"https://github.com/alex-sandercock"},"dateModified":"2025-06-20T12:02:45-04:00","datePublished":"2025-06-18T03:13:00-04:00","description":"Processing MADC data to filter low quality microhaplotypes and convert to a VCF format with biallelic SNPs","headline":"Processing MADC Genotype Data","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/BIGr_documentation/posts/madc-data-processing/"},"url":"http://localhost:4000/BIGr_documentation/posts/madc-data-processing/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Processing MADC Genotype Data | BIGr
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/BIGr_documentation/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/BIGr_documentation/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/BIGr_documentation/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/BIGr_documentation/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/BIGr_documentation/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="BIGr">
<meta name="application-name" content="BIGr">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/BIGr_documentation/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/BIGr_documentation/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/BIGr_documentation/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js,npm/mermaid@11.4.0/dist/mermaid.min.js"></script>







<script defer src="/BIGr_documentation/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  
    
        
          <!-- Display GoatCounter pageviews -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const pv = document.getElementById('pageviews');

    if (pv !== null) {
      const uri = location.pathname.replace(/\/$/, '');
      const url = `https://alex-sandercock.goatcounter.com/counter/${encodeURIComponent(uri)}.json`;

      fetch(url)
        .then((response) => response.json())
        .then((data) => {
          const count = data.count.replace(/\s/g, '');
          pv.innerText = new Intl.NumberFormat().format(count);
        })
        .catch((error) => {
          pv.innerText = '1';
        });
    }
  });
</script>

        
    
  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/BIGr_documentation/" id="avatar" class="rounded-circle"><img src="https://private-user-images.githubusercontent.com/39815775/373957547-2168c801-fcee-4999-b04e-f7b01fed9cfa.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NTAxOTA5MTEsIm5iZiI6MTc1MDE5MDYxMSwicGF0aCI6Ii8zOTgxNTc3NS8zNzM5NTc1NDctMjE2OGM4MDEtZmNlZS00OTk5LWIwNGUtZjdiMDFmZWQ5Y2ZhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTA2MTclMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwNjE3VDIwMDMzMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTNmMWFkOTI0M2E3N2I5MmY1ZDlkMjZmNDIxNTk5ZDdhNDRmYjZkZmM3MmUwZTdmMGE0NjJlZjhiZjNiNjE3NDMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.j0rZ2KNa24JoYpjJerWhgz-xPLaaNyelFP9sLq5YW1w" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/BIGr_documentation/">BIGr</a>
    <p class="site-subtitle fst-italic mb-0">Breeding Insight Genomics R Package</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/BIGr_documentation/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/BIGr_documentation/getting-started/" class="nav-link">
            <i class="fa-fw fas fa-rocket"></i>
            

            <span>GETTING STARTED</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/BIGr_documentation/tutorials/" class="nav-link">
            <i class="fa-fw fas fa-book-reader"></i>
            

            <span>TUTORIALS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/BIGr_documentation/faq/" class="nav-link">
            <i class="fa-fw fas fa-question-circle"></i>
            

            <span>FAQ</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/BIGr_documentation/polyploid_pipelines/" class="nav-link">
            <i class="fa-fw fas fa-microscope"></i>
            

            <span>POLYPLOID_PIPELINES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/BIGr_documentation/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/BIGr_documentation/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/BIGr_documentation/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/Breeding-Insight"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['ams866','cornell.edu'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/BIGr_documentation/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/BIGr_documentation/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Processing MADC Genotype Data</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>Processing MADC Genotype Data</h1>
    
      <p class="post-desc fw-light mb-4">Processing MADC data to filter low quality microhaplotypes and convert to a VCF format with biallelic SNPs</p>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1750230780"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Jun 18, 2025
</time>

      </span>

      <!-- lastmod date -->
      
        <span>
          Updated
          <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1750435365"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Jun 20, 2025
</time>

        </span>
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                <a href="https://github.com/alex-sandercock">Alexander M. Sandercock</a>
                
              
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          
            <span>
              <em id="pageviews">
                <i class="fas fa-spinner fa-spin small"></i>
              </em>
              views
            </span>
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="1720 words"
>
  <em>9 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">Processing MADC Genotype Data</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">Processing MADC Genotype Data</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <blockquote class="prompt-warning">
  <p>Extracting SNPs from an MADC files requires that Fixed Allele Ids have already been assigned.</p>
</blockquote>

<h2 id="introduction"><span class="me-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<pre><code class="language-mermaid">flowchart TD
    A(["Genotype Sequencing"]) --&gt; B["MADC File"]
    B --&gt; D["Fixed Allele IDs Assigned"]
    D --&gt; n3["Kinship Matrix"] &amp; n4["Convert to VCF"]
    B@{ shape: div-proc}
    D@{ shape: procs}
    n3@{ shape: db}
    n4@{ shape: db}
     A:::Aqua
     B:::Sky
     D:::Sky
     n3:::Peach
     n4:::Peach
    classDef Aqua stroke-width:1px, stroke-dasharray:none, stroke:#46EDC8, fill:#DEFFF8, color:#378E7A
    classDef Sky stroke-width:1px, stroke-dasharray:none, stroke:#374D7C, fill:#E2EBFF, color:#374D7C
    classDef Peach stroke-width:1px, stroke-dasharray:none, stroke:#FBB35A, fill:#FFEFDB, color:#8F632D
</code></pre>

<p>The <code class="language-plaintext highlighter-rouge">BIGr</code> package provides a suite of functions developed by the Breeding Insight program to analyze diploid and polyploid breeding and genetic data. It is designed to handle common genomics tasks, including filtering Variant Call Format (VCF) files, processing Diversity Arrays Technology (DArT) data, and manipulating genotype data for various species.</p>

<p>This vignette will walk you through a common workflow:</p>

<ol>
  <li><strong>Preparing MADC</strong> to remove low quality microhaplotypes.</li>
  <li><strong>Converting DArT MADC files</strong> to the more standard VCF format with biallelic SNPs.</li>
  <li><strong>Calculating dosages</strong> with the <code class="language-plaintext highlighter-rouge">updog</code> R package.</li>
  <li><strong>Filtering</strong> the resulting VCF file to ensure data quality.</li>
  <li><strong>Performing quality control</strong> checks on the filtered data.</li>
  <li><strong>Calculating summary statistics</strong> like Minor Allele Frequency (MAF) and Heterozygosity.</li>
</ol>

<h2 id="loading-the-required-packages-and-example-data"><span class="me-2">Loading the Required Packages and Example Data</span><a href="#loading-the-required-packages-and-example-data" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>We need to load the packages that we will be using for this tutorial</p>
<div class="language-R highlighter-rouge"><div class="code-header">
        <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">library</span><span class="p">(</span><span class="n">BIGr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">updog</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">vcfR</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>We will be working with an example MADC file that is provided with the <code class="language-plaintext highlighter-rouge">BIGr</code> package.</p>
<div class="language-R highlighter-rouge"><div class="code-header">
        <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">madc_file_path</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">system.file</span><span class="p">(</span><span class="s2">"example_MADC_FixedAlleleID.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">package</span><span class="o">=</span><span class="s2">"BIGr"</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="preprocessing-the-madc-file"><span class="me-2">Preprocessing the MADC File</span><a href="#preprocessing-the-madc-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>The MADC file contains the read count information for all of the target loci in the genotyping panel <strong><em>plus</em></strong> the alleles associated with each target region. The format has the microhaplotypes in the rows and the samples in the columns. Sometimes, these other alleles are not reliable due to having a much higher read depth than expected (likely from applification by duplicate sites) or extremely low read depth (potentially from sequencing errors).</p>

<p>So, we will first evaluate some basic statistics of these MADC files and then filter to remove these low-quality microhaplotypes.</p>

<p>Let’s first import the MADC file as a data frame object</p>
<div class="language-R highlighter-rouge"><div class="code-header">
        <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">#Import MADC</span><span class="w">
</span><span class="n">MADC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">madc_file_path</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s1">','</span><span class="p">,</span><span class="w"> </span><span class="n">check.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>
<p>In our example MADC file, we only have 10 individuals and 50 microhaplotypes.</p>

<p>Now we can check to see which microhaploypes have a read depth of at least 10 for at least two samples.</p>
<div class="language-R highlighter-rouge"><div class="code-header">
        <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c1">#Convert any read depths less than 10 to NA, otherwise switch to a value of 1.</span><span class="w">
</span><span class="n">MADC_count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">MADC</span><span class="p">[,</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="c1"># Use a value less than 10 if you feel it is too stringent of a read depth value</span><span class="w">

</span><span class="c1">#Sum up the number of individuals with at least a read depth of 10 for each microhaplotype</span><span class="w">
</span><span class="n">MADC_sums</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">MADC_count</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1">#Make a histogram of the distribution</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">MADC_sums</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> 
     </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Distribution of mHaps with individuals with &gt;10 Reads"</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Number of samples at each mHap with &gt;10 reads"</span><span class="p">,</span><span class="w">
     </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Frequency"</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">MADC_sums</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="m">10</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span><span class="w">

</span><span class="c1">#Counting the number of individuals removed with thresholds:</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">MADC_sums</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1">#We will remove 12 microhaplotypes with this threshold</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">MADC_sums</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="c1">#20</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>
<p>Typically, we like to set a minimum read depth of a microhaplotype at each sample as 10, but this is not always possible if the overall quality of the genotyping data is low. This can happen if lower quality tissue or DNA was used for sequencing.</p>

<p>Another metric we should evaluate is the distribution of the mean read depth across all samples for each microhaplotype</p>
<div class="language-R highlighter-rouge"><div class="code-header">
        <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c1">#Get the distribution of read counts and mHaps</span><span class="w">
</span><span class="n">mean_reads</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">rowMeans</span><span class="p">(</span><span class="n">MADC</span><span class="p">[,</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)],</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">

</span><span class="c1">#Calculate the upper bound of the 95th percentile for the mean read depths.</span><span class="w">
</span><span class="n">upper_bound</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">mean_reads</span><span class="p">[,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="m">0.95</span><span class="p">)</span><span class="w">

</span><span class="c1">#Plot the distribution</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">mean_reads</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">v</span><span class="o">=</span><span class="n">upper_bound</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>
<p>Using the upper_bound as a maximum read depth threshold seems like a good option. This remove any of the microhaplotypes that were likely contaminated by duplicate sites, while also reducing the potential for remove valid microhaplotypes.</p>

<p>We have determined the thresholds we would like to use for filtering the MADC file. We can now apply those filtering thresholds.</p>
<div class="language-R highlighter-rouge"><div class="code-header">
        <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c1"># Making a temporary file to output the MADC for this example only. </span><span class="w">
</span><span class="c1"># It is recommended to save the filtered MADC directly to your computer.</span><span class="w">
</span><span class="n">filtered_madc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tempfile</span><span class="p">(</span><span class="n">fileext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">".csv"</span><span class="p">)</span><span class="w">

</span><span class="n">BIGr</span><span class="o">::</span><span class="n">filterMADC</span><span class="p">(</span><span class="n">madc_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">madc_file_path</span><span class="p">,</span><span class="w">
                 </span><span class="n">min.mean.reads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w">
                 </span><span class="n">max.mean.reads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">upper_bound</span><span class="p">,</span><span class="w">
                 </span><span class="n">min.reads.per.site</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w">
                 </span><span class="n">min.ind.with.reads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
                 </span><span class="n">output.file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filtered_madc</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<blockquote class="prompt-warning">
  <p>While it is important to provide filtering of the MADC file, there will be additional filtering of the extracted SNPs later. So, I recommend at least applying the maximum read depth filter, but being cautious with how stringently you filter with the other parameters if you intend to extract bi-allelic SNPs from this MADC file.</p>
</blockquote>

<h2 id="data-conversion-from-madc-to-vcf"><span class="me-2">Data Conversion: From MADC to VCF</span><a href="#data-conversion-from-madc-to-vcf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Genomics data comes in many formats. <code class="language-plaintext highlighter-rouge">BIGr</code> provides functions to convert proprietary formats, like DArT’s Missing Allele Discovery Count (MADC), into the widely used VCF format. The <code class="language-plaintext highlighter-rouge">madc2vcf_all</code> function is used for this purpose, extracting the read counts for both the target and off-target markers from the genotyping panel.</p>

<p>The required files for this will be:</p>
<ol>
  <li>The filtered MADC file</li>
  <li>The botloci file</li>
  <li>The database file
The botloci file and database files are explained <strong>here</strong> and can be obtained directly from the Breeding Insight GitHub for supported species</li>
</ol>

<p>Let’s extract the read counts for the target and off-target biallelic SNPs</p>
<div class="language-R highlighter-rouge"><div class="code-header">
        <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="n">madc_file</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">system.file</span><span class="p">(</span><span class="s2">"example_MADC_FixedAlleleID.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">package</span><span class="o">=</span><span class="s2">"BIGr"</span><span class="p">)</span><span class="w">
</span><span class="n">bot_file</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">system.file</span><span class="p">(</span><span class="s2">"example_SNPs_DArTag-probe-design_f180bp.botloci"</span><span class="p">,</span><span class="w"> </span><span class="n">package</span><span class="o">=</span><span class="s2">"BIGr"</span><span class="p">)</span><span class="w">
</span><span class="n">db_file</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">system.file</span><span class="p">(</span><span class="s2">"example_allele_db.fa"</span><span class="p">,</span><span class="w"> </span><span class="n">package</span><span class="o">=</span><span class="s2">"BIGr"</span><span class="p">)</span><span class="w">

</span><span class="c1">#Temp output file location for the VCF file</span><span class="w">
</span><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"extracted_madc_snps.vcf"</span><span class="w">

</span><span class="c1">#Extracting the SNPs</span><span class="w">
</span><span class="n">madc2vcf_all</span><span class="p">(</span><span class="n">madc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">madc_file</span><span class="p">,</span><span class="w">
               </span><span class="n">botloci_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bot_file</span><span class="p">,</span><span class="w">
               </span><span class="n">hap_seq_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db_file</span><span class="p">,</span><span class="w">
               </span><span class="n">n.cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">rm_multiallelic_SNP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
               </span><span class="n">multiallelic_SNP_dp_thr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
               </span><span class="n">multiallelic_SNP_sample_thr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
               </span><span class="n">alignment_score_thr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w">
               </span><span class="n">out_vcf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">,</span><span class="w">
               </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># You can now view the first few lines of the created VCF file</span><span class="w">
</span><span class="n">readLines</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="calculating-dosages"><span class="me-2">Calculating Dosages</span><a href="#calculating-dosages" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>The previous step generates a VCF file with biallelic SNPs, but it does not include dosage information. To calculate dosages, we can use the <code class="language-plaintext highlighter-rouge">updog</code> package, which is designed for this purpose.</p>

<p>First, we need to extract the reference (RA) and the total depth (DP) value from each SNP in the VCF file.</p>
<div class="language-R highlighter-rouge"><div class="code-header">
        <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="c1">#Get the path to the VCF file with read count information</span><span class="w">
</span><span class="n">vcf_file</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"extracted_madc_snps.vcf"</span><span class="w">

</span><span class="c1">#Initialize matrices list</span><span class="w">
</span><span class="n">matrices</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span><span class="w">

</span><span class="c1">#Import genotype information if in VCF format</span><span class="w">
</span><span class="n">vcf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.vcfR</span><span class="p">(</span><span class="n">vcf_file</span><span class="p">,</span><span class="w"> </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1">#Extract DP and RA and convert to matrices</span><span class="w">
</span><span class="n">matrices</span><span class="o">$</span><span class="n">size_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">extract.gt</span><span class="p">(</span><span class="n">vcf</span><span class="p">,</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"DP"</span><span class="p">)</span><span class="w">
</span><span class="n">matrices</span><span class="o">$</span><span class="n">ref_matrix</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">extract.gt</span><span class="p">(</span><span class="n">vcf</span><span class="p">,</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"RA"</span><span class="p">)</span><span class="w">
</span><span class="nf">class</span><span class="p">(</span><span class="n">matrices</span><span class="o">$</span><span class="n">size_matrix</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"numeric"</span><span class="w">
</span><span class="nf">class</span><span class="p">(</span><span class="n">matrices</span><span class="o">$</span><span class="n">ref_matrix</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"numeric"</span><span class="w">
</span><span class="c1">#Assign the row names as the concatenated chromosome and position values</span><span class="w">
</span><span class="n">rownames</span><span class="p">(</span><span class="n">matrices</span><span class="o">$</span><span class="n">size_matrix</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">matrices</span><span class="o">$</span><span class="n">ref_matrix</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">chrom</span><span class="p">,</span><span class="w"> </span><span class="s2">"_"</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w">

</span><span class="n">rm</span><span class="p">(</span><span class="n">vcf</span><span class="p">)</span><span class="w"> </span><span class="c1">#Remove VCF</span><span class="w">

</span><span class="c1"># View the format of each matrix</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">matrices</span><span class="o">$</span><span class="n">size_matrix</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">])</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">matrices</span><span class="o">$</span><span class="n">ref_matrix</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">])</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Now that we have the read count values in two separate matrices, we can use the <code class="language-plaintext highlighter-rouge">updog</code> package to calculate the dosages. The <code class="language-plaintext highlighter-rouge">multidog</code> function from <code class="language-plaintext highlighter-rouge">updog</code> will perform this calculation, and we can specify the ploidy level of the species. For more detailed information about the <code class="language-plaintext highlighter-rouge">updog</code> package, please refer to its documentation.</p>
<div class="language-R highlighter-rouge"><div class="code-header">
        <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c1"># Estimating the dosage values from the read count data with Updog</span><span class="w">
</span><span class="c1"># Note: Updog will take longer to run to completion with more SNPs being evaluated. Increase the nc "cores"</span><span class="w">
</span><span class="c1"># value if the resources are available to speed up the analysis.</span><span class="w">
</span><span class="n">mout</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">updog</span><span class="o">::</span><span class="n">multidog</span><span class="p">(</span><span class="n">refmat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrices</span><span class="o">$</span><span class="n">ref_matrix</span><span class="p">,</span><span class="w">
                        </span><span class="n">sizemat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrices</span><span class="o">$</span><span class="n">size_matrix</span><span class="p">,</span><span class="w">
                        </span><span class="n">ploidy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
                        </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"norm"</span><span class="p">,</span><span class="w">
                        </span><span class="n">nc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">

</span></pre></td></tr></tbody></table></code></div></div>

<p>Finally, we can use the <code class="language-plaintext highlighter-rouge">BIGr::updog2vcf</code> function to convert the <code class="language-plaintext highlighter-rouge">updog</code> output into a VCF file format. This function will create a VCF file that includes the dosage information calculated by <code class="language-plaintext highlighter-rouge">updog</code> and the associated statistics that will be useful for quality filtering.</p>
<div class="language-R highlighter-rouge"><div class="code-header">
        <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c1"># Convert updog to VCF</span><span class="w">
</span><span class="n">updog2vcf</span><span class="p">(</span><span class="w">
    </span><span class="n">multidog.object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mout</span><span class="p">,</span><span class="w">
    </span><span class="n">output.file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"updog_output.vcf.gz"</span><span class="p">,</span><span class="w">
    </span><span class="n">updog_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">packageVersion</span><span class="p">(</span><span class="s2">"updog"</span><span class="p">),</span><span class="w">
    </span><span class="n">compress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="filtering-vcf-files"><span class="me-2">Filtering VCF Files</span><a href="#filtering-vcf-files" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>After generating a VCF file, the next step is typically to filter it to remove low-quality SNPs and samples. The <code class="language-plaintext highlighter-rouge">filterVCF</code> function offers several filtering parameters based on common quality metrics.</p>

<h3 id="example-filtering-a-vcf-file-with-filtervcf"><span class="me-2">Example: Filtering a VCF File with <code class="language-plaintext highlighter-rouge">filterVCF</code></span><a href="#example-filtering-a-vcf-file-with-filtervcf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<p>Here, we’ll filter a VCF file to remove SNPs with a Minor Allele Frequency (MAF) below 0.01, an <code class="language-plaintext highlighter-rouge">updog</code> Overdispersion (OD) filter greater than 0.5, and a missing data threshold of 50% for both SNPs and samples. This ensures that we retain only high-quality data for further analysis.</p>
<div class="language-R highlighter-rouge"><div class="code-header">
        <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">filterVCF</span><span class="p">(</span><span class="w">
  </span><span class="n">vcf.file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"updog_output.vcf.gz"</span><span class="p">,</span><span class="w">
  </span><span class="n">filter.OD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">          </span><span class="c1"># Updog Overdispersion filter</span><span class="w">
  </span><span class="n">filter.MAF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.01</span><span class="p">,</span><span class="w">        </span><span class="c1"># Minor Allele Frequency filter</span><span class="w">
  </span><span class="n">filter.SNP.miss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">    </span><span class="c1"># Missing SNP data filter</span><span class="w">
  </span><span class="n">filter.SAMPLE.miss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="c1"># Missing sample data filter</span><span class="w">
  </span><span class="n">ploidy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">               </span><span class="c1"># Ploidy level of the species</span><span class="w">
  </span><span class="n">output.file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"filtered_output.vcf.gz"</span><span class="w"> </span><span class="c1"># Output file path</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="quality-control"><span class="me-2">Quality Control</span><a href="#quality-control" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p><code class="language-plaintext highlighter-rouge">BIGr</code> includes functions to assess the quality of your genotype data, such as checking for sample mislabeling.</p>

<h3 id="checking-replicates-and-sample-compatibility"><span class="me-2">Checking Replicates and Sample Compatibility</span><a href="#checking-replicates-and-sample-compatibility" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The <code class="language-plaintext highlighter-rouge">check_replicates</code> function assesses the compatibility between all pairs of samples in a VCF file by calculating the percentage of matching genotypes. This is useful for identifying duplicated samples or potential sample swaps.</p>

<div class="language-R highlighter-rouge"><div class="code-header">
        <span data-label-text="R"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c1"># Path to an example VCF file</span><span class="w">
</span><span class="n">example_vcf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"filtered_output.vcf.gz"</span><span class="w">

</span><span class="c1"># Run the replicate check on the first 10 samples for this example</span><span class="w">
</span><span class="n">check_tab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">check_replicates</span><span class="p">(</span><span class="n">path.vcf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">example_vcf</span><span class="p">,</span><span class="w">
                              </span><span class="n">select_samples</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w">
                              </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Display the first few rows of the results</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">check_tab</span><span class="p">)</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>The output table shows the percentage of matching and missing genotypes for each sample pair, allowing you to identify pairs with unexpectedly high or low concordance.</p>

<h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>The <code class="language-plaintext highlighter-rouge">BIGr</code> package provides a powerful and user-friendly toolkit for processing and analyzing genomic data for both diploid and polyploid species. This vignette has covered a standard workflow, but the package includes many other functions for tasks like checking pedigrees (<code class="language-plaintext highlighter-rouge">check_ped</code>), handling <code class="language-plaintext highlighter-rouge">updog</code> output (<code class="language-plaintext highlighter-rouge">updog2vcf</code>), and more. For further details, please refer to the official package documentation.</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/BIGr_documentation/tutorials/genotype-processing/">Genotype Processing</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/BIGr_documentation/tags/madc/"
            class="post-tag no-text-decoration"
          >madc</a>
        
          <a
            href="/BIGr_documentation/tags/filtering/"
            class="post-tag no-text-decoration"
          >filtering</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Processing%20MADC%20Genotype%20Data%20-%20BIGr&url=http%3A%2F%2Flocalhost%3A4000%2FBIGr_documentation%2Fposts%2Fmadc-data-processing%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Processing%20MADC%20Genotype%20Data%20-%20BIGr&u=http%3A%2F%2Flocalhost%3A4000%2FBIGr_documentation%2Fposts%2Fmadc-data-processing%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2FBIGr_documentation%2Fposts%2Fmadc-data-processing%2F&text=Processing%20MADC%20Genotype%20Data%20-%20BIGr" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/BIGr_documentation/posts/madc-file-format/">MADC File Format</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/BIGr_documentation/posts/madc-data-processing/">Processing MADC Genotype Data</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/BIGr_documentation/tags/madc/">madc</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/BIGr_documentation/tags/filtering/">filtering</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  
    










  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/BIGr_documentation/posts/madc-file-format/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1750225560"
  data-df="ll"
  
>
  Jun 18, 2025
</time>

              <h4 class="pt-0 my-2">MADC File Format</h4>
              <div class="text-muted">
                <p>Description of the DArT MADC file</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/BIGr_documentation/posts/madc-file-format/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>MADC File Format</p>
    </a>
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Newer">
      <p>-</p>
    </div>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://github.com/Breeding-Insight">Breeding Insight</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.3.0"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/BIGr_documentation/tags/madc/">madc</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/BIGr_documentation/tags/filtering/">filtering</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/BIGr_documentation/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

